<!--Evaluadores-->
{% extends 'base.html' %}
{% block content %}
    <!-- Titulo -->
    <div class="w3-container" id="portada" style="margin-top:80px; margin-bottom:10px">
        <h1 class="w3-xxxlarge w3-text-red"><b>Evaluadores</b></h1>
        <hr style="width:50px;border:5px solid red" class="w3-round">
        <p class="w3-col"><h3>Seleccione un evaluador</h3>

    <input id='buscar'  type='text' placeholder="Busque algún evaluador">    
    </div>

    <!-- Evaluadores registrados -->
    
    <div class="w3-margin-top w3-container w3-center">
        <table class="w3-table">
            <thead>
                <tr>
                    <th> Nombre </th>
                    <th> Email </th>
                </tr>
            </thead>
            <script>
                var evaluadoresJs= new Array();
                var evaluadorJs= new Array();
            </script>
            <tbody id='evaluadores'>
            {% for evaluador in evaluadores_list %}
            <tr>
                <td>{{evaluador}}</td>
                <td class="w3-small"> {{ evaluador.get_email }} </td>
                <!-- Javascript scan for evaluadores with format {(name,lastname,email),(name,lastname,email)...}-->
                <script>
                    evaluadorJs=[];
                    evaluadorJs.push('{{evaluador.get_name}}');
                    evaluadorJs.push('{{evaluador.get_lastname}}');
                    evaluadorJs.push('{{evaluador.get_email}}');

                    evaluadoresJs.push(evaluadorJs);
                </script>

            
            </tr>
            {% endfor %}
            </tbody>
           
            
            
            <script>
                function buscarEvaluador(){
                    let busqueda = document.getElementById('buscar').value;

                    let filtered = evaluadoresJs.filter((x)=>{
                        if(busqueda==""){
                            return true;}
                        
                        let raw_palabras = x[0]+" "+x[1]+" "+x[2];
                        
                        let palabras = raw_palabras.split(" ");
                        for(let i=0; i<palabras.length; i++){
                            if(palabras[i].toLowerCase()==busqueda.toLowerCase()){
                                return true;
                            }

                        }
                        return false;
                        
                    });
                    texto="";
                    for(i=0; i<filtered.length; i++){
                        texto+="<tr>";
                        texto+=("<td>"+filtered[i][0]+" ");
                        texto+=(filtered[i][1]+"</td>");
                        texto+=("<td class='w3-small'>"+filtered[i][2]+"</td>");
                        texto+="</tr>";
                    }
                    
                    document.getElementById('evaluadores').innerHTML=texto;
                }
                document.getElementById('buscar').addEventListener('keydown',event=>{
                    if(event.key=='Enter'){
                        buscarEvaluador();
                    }
                });
            </script>
            
        </table>
    </div>
    
    


    <div class="w3-margin-top w3-container w3-center">
    <button onclick="document.getElementById('agregar').style.display='block'" class="w3-col w3-round w3-button w3-red w3-right">
            <i class="fas fa-user-plus" style="text-align: center"></i>
            Agregar evaluador</button>
    </div>
   
    <!-- Formulario de agregar -->
    <div id="agregar" class="w3-modal">
    <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
        <div class="w3-center"><br>
            <span onclick="document.getElementById('agregar').style.display='none'" class="w3-button w3-xlarge w3-transparent w3-display-topright" title="Close Modal">×</span>
            <form class="w3-container" action="{% url 'evaluadores:add_evaluador' %}" method="post">
                {% csrf_token %}
                <table class="w3-table">
                    {{ form.as_table }}
                </table>
            <button class="w3-button w3-block w3-red w3-section w3-padding" type="submit">Agregar</button>
            </form>
      </div>
    </div>
    </div>
    <!-- Cierre de formulario de agregar -->

{% endblock %}